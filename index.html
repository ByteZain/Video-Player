<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Video Player - Production Ready</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-bg: #0a0e27;
            --secondary-bg: #1a1f3a;
            --accent-color: #667eea;
            --text-primary: #ffffff;
            --text-secondary: #b2b8d4;
            --error-color: #ff6b6b;
            --success-color: #4ecdc4;
            --border-radius: 8px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-color), #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        /* Input Section */
        .input-section {
            background: var(--secondary-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group.full-width {
            grid-column: 1 / -1;
        }
        
        .input-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .input-group input, .input-group textarea, .input-group select {
            padding: 12px 16px;
            border: 2px solid transparent;
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
        }
        
        /* Buttons */
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--accent-color), #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 140px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }
        
        /* Player Section */
        .player-section {
            background: var(--secondary-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: none;
        }
        
        .player-container {
            position: relative;
            width: 100%;
            height: 70vh;
            border-radius: var(--border-radius);
            overflow: hidden;
            background: #000;
            margin-bottom: 25px;
        }
        
        .player-container iframe, 
        .player-container video {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Enhanced Video Controls */
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .player-container:hover .video-controls {
            transform: translateY(0);
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            border-radius: var(--border-radius);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-card h3 {
            color: var(--accent-color);
            margin-bottom: 10px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .info-card p {
            color: var(--text-secondary);
            font-size: 14px;
            word-break: break-all;
            line-height: 1.4;
        }
        
        /* Download Section */
        .download-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .download-section h3 {
            margin-bottom: 20px;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .quality-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .quality-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .quality-btn:hover, .quality-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            font-weight: 500;
            display: none;
        }
        
        .alert.error {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }
        
        .alert.success {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        
        .alert.warning {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            color: #ffc107;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .player-container {
                height: 50vh;
            }
            
            .controls {
                justify-content: stretch;
            }
            
            .btn {
                flex: 1;
                min-width: auto;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Advanced Styling */
        .player-stats {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 11px;
            color: white;
            font-family: monospace;
        }
        
        .stream-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4ecdc4;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Universal Video Player</h1>
            <p>Production-ready streaming player with download support</p>
        </div>
        
        <div class="input-section">
            <div class="input-grid">
                <div class="input-group">
                    <label for="videoTitle">Video Title</label>
                    <input type="text" id="videoTitle" placeholder="Enter video title">
                </div>
                
                <div class="input-group">
                    <label for="videoDuration">Duration</label>
                    <input type="text" id="videoDuration" placeholder="e.g., 15:30">
                </div>
                
                <div class="input-group full-width">
                    <label for="videoUrl">Video URL (Direct Link or Iframe)</label>
                    <input type="url" id="videoUrl" placeholder="https://example.com/video.mp4 or iframe URL">
                </div>
                
                <div class="input-group full-width">
                    <label for="downloadLinks">Download Links (JSON format)</label>
                    <textarea id="downloadLinks" placeholder='[{"quality":"720p","size":"45.2MB","url":"https://example.com/video.mp4"}]'></textarea>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="loadVideo()">Stream Video</button>
                <button class="btn btn-secondary" onclick="loadDownloadOptions()">Load Downloads</button>
                <button class="btn btn-danger" onclick="clearAll()">Clear All</button>
            </div>
        </div>
        
        <div id="alerts">
            <div id="errorAlert" class="alert error"></div>
            <div id="successAlert" class="alert success"></div>
            <div id="warningAlert" class="alert warning"></div>
        </div>
        
        <div id="playerSection" class="player-section">
            <div class="player-container" id="playerContainer">
                <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Loading video...</p>
                </div>
                
                <div class="video-controls">
                    <div class="control-buttons">
                        <button class="control-btn" onclick="togglePlayPause()">Play/Pause</button>
                        <button class="control-btn" onclick="toggleMute()">Mute</button>
                        <button class="control-btn" onclick="toggleFullscreen()">Fullscreen</button>
                        <button class="control-btn" onclick="downloadCurrentVideo()">Download</button>
                    </div>
                </div>
                
                <div class="player-stats" id="playerStats" style="display: none;">
                    <span class="stream-indicator"></span>
                    <span id="statsText">Loading...</span>
                </div>
            </div>
            
            <div class="info-grid">
                <div class="info-card">
                    <h3>Video Information</h3>
                    <p id="videoInfo">No video loaded</p>
                </div>
                <div class="info-card">
                    <h3>Stream Status</h3>
                    <p id="streamStatus">Ready</p>
                </div>
                <div class="info-card">
                    <h3>Current Source</h3>
                    <p id="currentSource">None</p>
                </div>
            </div>
            
            <div class="download-section">
                <h3>Quality Options</h3>
                <div id="qualitySelector" class="quality-selector">
                    <button class="quality-btn">No options available</button>
                </div>
                <div id="downloadInfo">
                    <p>Load download links to see quality options</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class VideoPlayer {
            constructor() {
                this.currentVideo = null;
                this.downloadLinks = [];
                this.isStreaming = false;
                this.currentQuality = null;
            }

            showAlert(type, message, duration = 5000) {
                const alert = document.getElementById(type + 'Alert');
                alert.textContent = message;
                alert.style.display = 'block';
                
                setTimeout(() => {
                    alert.style.display = 'none';
                }, duration);
            }

            showLoading(show = true) {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = show ? 'flex' : 'none';
            }

            updateVideoInfo(title, duration, url) {
                const info = `${title || 'Untitled'} • ${duration || 'Unknown duration'}`;
                document.getElementById('videoInfo').textContent = info;
                document.getElementById('currentSource').textContent = this.getDomain(url);
            }

            updateStreamStatus(status) {
                document.getElementById('streamStatus').textContent = status;
            }

            updatePlayerStats(stats) {
                const statsElement = document.getElementById('playerStats');
                const statsText = document.getElementById('statsText');
                
                if (stats) {
                    statsText.textContent = stats;
                    statsElement.style.display = 'block';
                } else {
                    statsElement.style.display = 'none';
                }
            }

            getDomain(url) {
                try {
                    return new URL(url).hostname;
                } catch {
                    return 'Unknown';
                }
            }

            async loadVideoStream(url, title, duration) {
                this.showLoading(true);
                this.updateStreamStatus('Connecting...');

                try {
                    const container = document.getElementById('playerContainer');
                    const existingMedia = container.querySelector('video, iframe');
                    
                    if (existingMedia) {
                        existingMedia.remove();
                    }

                    // Detect if URL is iframe or direct video
                    if (this.isIframeUrl(url)) {
                        await this.loadIframe(url, title, duration);
                    } else {
                        await this.loadDirectVideo(url, title, duration);
                    }

                    this.updateVideoInfo(title, duration, url);
                    document.getElementById('playerSection').style.display = 'block';
                    this.showAlert('success', 'Video loaded successfully!');

                } catch (error) {
                    this.showAlert('error', 'Error loading video: ' + error.message);
                    this.updateStreamStatus('Error');
                } finally {
                    this.showLoading(false);
                }
            }

            isIframeUrl(url) {
                // Check if URL contains common iframe indicators
                const iframeIndicators = ['/embed/', '/player/', 'iframe', 'embed'];
                return iframeIndicators.some(indicator => url.toLowerCase().includes(indicator));
            }

            async loadIframe(url, title, duration) {
                return new Promise((resolve, reject) => {
                    const iframe = document.createElement('iframe');
                    iframe.src = url;
                    iframe.allowFullscreen = true;
                    iframe.allow = 'autoplay; fullscreen; encrypted-media';
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                    iframe.frameBorder = '0';

                    iframe.onload = () => {
                        this.updateStreamStatus('Iframe loaded');
                        this.updatePlayerStats('Iframe embed • External player');
                        resolve();
                    };

                    iframe.onerror = () => {
                        reject(new Error('Failed to load iframe'));
                    };

                    const container = document.getElementById('playerContainer');
                    container.appendChild(iframe);
                    this.currentVideo = iframe;
                });
            }

            async loadDirectVideo(url, title, duration) {
                return new Promise((resolve, reject) => {
                    const video = document.createElement('video');
                    video.src = url;
                    video.controls = true;
                    video.preload = 'metadata';
                    video.style.width = '100%';
                    video.style.height = '100%';

                    // Enhanced video event handlers
                    video.onloadstart = () => {
                        this.updateStreamStatus('Loading...');
                        this.updatePlayerStats('Connecting to stream...');
                    };

                    video.onloadedmetadata = () => {
                        this.updateStreamStatus('Metadata loaded');
                        const stats = `${Math.round(video.duration)}s • ${video.videoWidth}x${video.videoHeight}`;
                        this.updatePlayerStats(stats);
                    };

                    video.oncanplay = () => {
                        this.updateStreamStatus('Ready to stream');
                        this.isStreaming = true;
                        resolve();
                    };

                    video.onplaying = () => {
                        this.updateStreamStatus('Streaming');
                    };

                    video.onpause = () => {
                        this.updateStreamStatus('Paused');
                    };

                    video.onended = () => {
                        this.updateStreamStatus('Completed');
                        this.isStreaming = false;
                    };

                    video.onerror = () => {
                        const error = video.error;
                        let errorMsg = 'Unknown error';
                        
                        switch(error?.code) {
                            case 1: errorMsg = 'Video loading aborted'; break;
                            case 2: errorMsg = 'Network error'; break;
                            case 3: errorMsg = 'Video decode error'; break;
                            case 4: errorMsg = 'Video format not supported'; break;
                        }
                        
                        reject(new Error(errorMsg));
                    };

                    video.onwaiting = () => {
                        this.updateStreamStatus('Buffering...');
                    };

                    const container = document.getElementById('playerContainer');
                    container.appendChild(video);
                    this.currentVideo = video;
                });
            }

            loadDownloadLinks(links) {
                try {
                    const parsed = typeof links === 'string' ? JSON.parse(links) : links;
                    
                    if (!Array.isArray(parsed)) {
                        throw new Error('Download links must be an array');
                    }

                    this.downloadLinks = parsed;
                    this.renderQualitySelector();
                    this.showAlert('success', `Loaded ${parsed.length} quality options`);
                    
                    // Auto-load highest quality for streaming
                    if (parsed.length > 0) {
                        const highestQuality = this.findHighestQuality(parsed);
                        if (highestQuality) {
                            this.selectQuality(highestQuality);
                        }
                    }

                } catch (error) {
                    this.showAlert('error', 'Invalid download links format: ' + error.message);
                }
            }

            findHighestQuality(links) {
                const qualityOrder = ['1080p', '720p', '480p', '360p', '240p'];
                
                for (const quality of qualityOrder) {
                    const found = links.find(link => link.quality === quality);
                    if (found) return found;
                }
                
                return links[0]; // Fallback to first link
            }

            renderQualitySelector() {
                const selector = document.getElementById('qualitySelector');
                selector.innerHTML = '';

                this.downloadLinks.forEach((link, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'quality-btn';
                    btn.textContent = `${link.quality} (${link.size})`;
                    btn.onclick = () => this.selectQuality(link);
                    selector.appendChild(btn);
                });

                // Update download info
                const info = document.getElementById('downloadInfo');
                info.innerHTML = `
                    <p><strong>${this.downloadLinks.length} quality options available</strong></p>
                    <p>Click a quality button to stream that version, or use controls to download.</p>
                `;
            }

            selectQuality(link) {
                // Update active button
                document.querySelectorAll('.quality-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.textContent.includes(link.quality));
                });

                this.currentQuality = link;
                
                // Load video with selected quality
                const title = document.getElementById('videoTitle').value || 'Video';
                const duration = document.getElementById('videoDuration').value || 'Unknown';
                
                this.loadVideoStream(link.url, `${title} (${link.quality})`, duration);
            }

            // Control methods
            togglePlayPause() {
                if (this.currentVideo && this.currentVideo.tagName === 'VIDEO') {
                    if (this.currentVideo.paused) {
                        this.currentVideo.play();
                    } else {
                        this.currentVideo.pause();
                    }
                }
            }

            toggleMute() {
                if (this.currentVideo && this.currentVideo.tagName === 'VIDEO') {
                    this.currentVideo.muted = !this.currentVideo.muted;
                }
            }

            toggleFullscreen() {
                const container = document.getElementById('playerContainer');
                
                if (!document.fullscreenElement) {
                    container.requestFullscreen().catch(err => {
                        this.showAlert('error', 'Fullscreen error: ' + err.message);
                    });
                } else {
                    document.exitFullscreen();
                }
            }

            downloadCurrentVideo() {
                if (this.currentQuality && this.currentQuality.url) {
                    const link = document.createElement('a');
                    link.href = this.currentQuality.url;
                    link.download = '';
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    this.showAlert('success', 'Download started!');
                } else {
                    this.showAlert('warning', 'No download URL available');
                }
            }

            clearAll() {
                // Clear inputs
                document.getElementById('videoTitle').value = '';
                document.getElementById('videoDuration').value = '';
                document.getElementById('videoUrl').value = '';
                document.getElementById('downloadLinks').value = '';

                // Clear player
                const container = document.getElementById('playerContainer');
                const mediaElement = container.querySelector('video, iframe');
                if (mediaElement) {
                    mediaElement.remove();
                }

                // Reset state
                this.currentVideo = null;
                this.downloadLinks = [];
                this.isStreaming = false;
                this.currentQuality = null;

                // Hide player section
                document.getElementById('playerSection').style.display = 'none';

                // Reset UI
                document.getElementById('qualitySelector').innerHTML = '<button class="quality-btn">No options available</button>';
                document.getElementById('downloadInfo').innerHTML = '<p>Load download links to see quality options</p>';
                
                this.updateStreamStatus('Ready');
                this.updatePlayerStats(null);

                this.showAlert('success', 'All data cleared!');
            }
        }

        // Initialize player
        const player = new VideoPlayer();

        // Global functions for UI
        function loadVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            const title = document.getElementById('videoTitle').value.trim();
            const duration = document.getElementById('videoDuration').value.trim();

            if (!url) {
                player.showAlert('error', 'Please enter a video URL');
                return;
            }

            player.loadVideoStream(url, title, duration);
        }

        function loadDownloadOptions() {
            const links = document.getElementById('downloadLinks').value.trim();

            if (!links) {
                player.showAlert('error', 'Please enter download links in JSON format');
                return;
            }

            player.loadDownloadLinks(links);
            document.getElementById('playerSection').style.display = 'block';
        }

        function clearAll() {
            player.clearAll();
        }

        function togglePlayPause() {
            player.togglePlayPause();
        }

        function toggleMute() {
            player.toggleMute();
        }

        function toggleFullscreen() {
            player.toggleFullscreen();
        }

        function downloadCurrentVideo() {
            player.downloadCurrentVideo();
        }

        // URL Parameters support
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            
            if (params.get('title')) {
                document.getElementById('videoTitle').value = decodeURIComponent(params.get('title'));
            }
            
            if (params.get('duration')) {
                document.getElementById('videoDuration').value = decodeURIComponent(params.get('duration'));
            }
            
            if (params.get('url')) {
                document.getElementById('videoUrl').value = decodeURIComponent(params.get('url'));
            }
            
            if (params.get('downloads')) {
                try {
                    const downloads = JSON.parse(decodeURIComponent(params.get('downloads')));
                    document.getElementById('downloadLinks').value = JSON.stringify(downloads, null, 2);
                } catch (e) {
                    console.warn('Invalid downloads parameter');
                }
            }

            // Auto-load if URL parameter exists
            if (params.get('autoload') === 'true') {
                setTimeout(() => {
                    if (document.getElementById('videoUrl').value) {
                        loadVideo();
                    } else if (document.getElementById('downloadLinks').value) {
                        loadDownloadOptions();
                    }
                }, 500);
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return; // Don't handle shortcuts when typing
            }

            switch(e.key.toLowerCase()) {
                case ' ':
                    e.preventDefault();
                    togglePlayPause();
                    break;
                case 'f':
                    e.preventDefault();
                    toggleFullscreen();
                    break;
                case 'm':
                    e.preventDefault();
                    toggleMute();
                    break;
                case 'c':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        clearAll();
                    }
                    break;
            }
        });
    </script>
</body>
</html>
